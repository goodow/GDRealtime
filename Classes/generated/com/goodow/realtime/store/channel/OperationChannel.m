//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/channel/OperationChannel.java
//
//  Created by retechretech.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/goodow/realtime/channel/Bus.h"
#include "com/goodow/realtime/channel/Message.h"
#include "com/goodow/realtime/channel/impl/ReliableSubscribeBus.h"
#include "com/goodow/realtime/core/Handler.h"
#include "com/goodow/realtime/core/Platform.h"
#include "com/goodow/realtime/core/Registration.h"
#include "com/goodow/realtime/core/Scheduler.h"
#include "com/goodow/realtime/json/Json.h"
#include "com/goodow/realtime/json/JsonElement.h"
#include "com/goodow/realtime/json/JsonObject.h"
#include "com/goodow/realtime/operation/Operation.h"
#include "com/goodow/realtime/operation/Transformer.h"
#include "com/goodow/realtime/store/channel/Constants.h"
#include "com/goodow/realtime/store/channel/OperationChannel.h"
#include "com/goodow/realtime/store/channel/TransformQueue.h"
#include "java/lang/AssertionError.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Throwable.h"
#include "java/lang/Void.h"
#include "java/util/EnumSet.h"
#include "java/util/logging/Level.h"
#include "java/util/logging/Logger.h"

BOOL ComGoodowRealtimeStoreChannelOperationChannel_initialized = NO;

@implementation ComGoodowRealtimeStoreChannelOperationChannel

JavaUtilLoggingLogger * ComGoodowRealtimeStoreChannelOperationChannel_logger_;

- (id)initWithNSString:(NSString *)id_
withComGoodowRealtimeOperationTransformer:(id<ComGoodowRealtimeOperationTransformer>)transformer
withComGoodowRealtimeChannelBus:(id<ComGoodowRealtimeChannelBus>)bus
withComGoodowRealtimeStoreChannelOperationChannel_Listener:(id<ComGoodowRealtimeStoreChannelOperationChannel_Listener>)listener {
  if (self = [super init]) {
    maybeSendTask_ = [[ComGoodowRealtimeStoreChannelOperationChannel_$1 alloc] initWithComGoodowRealtimeStoreChannelOperationChannel:self];
    state_ = ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_UNINITIALISED();
    self->id__ = id_;
    self->transformer_ = transformer;
    self->bus_ = bus;
    self->queue_ = [[ComGoodowRealtimeStoreChannelTransformQueue alloc] initWithComGoodowRealtimeOperationTransformer:transformer];
    self->listener_ = listener;
  }
  return self;
}

- (void)connectWithDouble:(double)version_ {
  NSAssert(![self isConnected], @"Already connected");
  NSAssert(version_ >= 0, [[NSString stringWithFormat:@"Invalid version J2OBJC_COMMA() %f" J2OBJC_COMMA() version_] description]);
  NSString *addr = [NSString stringWithFormat:@"%@/%@%@", ComGoodowRealtimeStoreChannelConstants_Topic_get_STORE_(), id__, ComGoodowRealtimeStoreChannelConstants_Topic_get_WATCH_()];
  if ([(id) bus_ isKindOfClass:[ComGoodowRealtimeChannelImplReliableSubscribeBus class]]) {
    [((ComGoodowRealtimeChannelImplReliableSubscribeBus *) nil_chk(((ComGoodowRealtimeChannelImplReliableSubscribeBus *) check_class_cast(bus_, [ComGoodowRealtimeChannelImplReliableSubscribeBus class])))) synchronizeSequenceNumberWithNSString:addr withDouble:version_ - 1];
  }
  handlerRegistration_ = [((id<ComGoodowRealtimeChannelBus>) nil_chk(bus_)) subscribeWithNSString:addr withComGoodowRealtimeCoreHandler:[[ComGoodowRealtimeStoreChannelOperationChannel_$2 alloc] initWithComGoodowRealtimeStoreChannelOperationChannel:self]];
  [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) init__WithDouble:version_];
  [self setStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_ACKED()];
}

- (void)disconnect {
  if ([self isConnected]) {
    [((id<ComGoodowRealtimeCoreRegistration>) nil_chk(handlerRegistration_)) unregister];
    handlerRegistration_ = nil;
    [self setStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_UNINITIALISED()];
  }
}

- (id)peek {
  [self checkConnected];
  return [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) hasServerOp] ? [queue_ peekServerOp] : nil;
}

- (id)receive {
  [self checkConnected];
  return [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) hasServerOp] ? [queue_ removeServerOp] : nil;
}

- (void)sendWithId:(id<ComGoodowRealtimeOperationOperation>)operation {
  [self checkConnected];
  [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) clientOpWithId:operation];
  if (!isMaybeSendTaskScheduled_ && [queue_ unackedClientOp] == nil) {
    NSAssert(state_ == ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_ACKED(), @"/Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/channel/OperationChannel.java:187 condition failed: assert state == State.ACKED;");
    isMaybeSendTaskScheduled_ = YES;
    [((id<ComGoodowRealtimeCoreScheduler>) nil_chk([ComGoodowRealtimeCorePlatform scheduler])) scheduleDeferredWithComGoodowRealtimeCoreHandler:maybeSendTask_];
  }
}

- (double)version__ {
  [self checkConnected];
  return [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) version__];
}

- (void)acked {
  [self setStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_ACKED()];
  if (!isMaybeSendTaskScheduled_ && [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) hasQueuedClientOps]) {
    isMaybeSendTaskScheduled_ = YES;
    [((id<ComGoodowRealtimeCoreScheduler>) nil_chk([ComGoodowRealtimeCorePlatform scheduler])) scheduleDeferredWithComGoodowRealtimeCoreHandler:maybeSendTask_];
  }
}

- (void)checkConnected {
  NSAssert([self isConnected], @"Not connected");
}

- (void)checkStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:(ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *)newState {
  switch ([newState ordinal]) {
    case ComGoodowRealtimeStoreChannelOperationChannel_State_UNINITIALISED:
    break;
    case ComGoodowRealtimeStoreChannelOperationChannel_State_ACKED:
    NSAssert([((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) version__] >= 0, @"/Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/channel/OperationChannel.java:215 condition failed: assert queue.version() >= 0;");
    NSAssert([queue_ unackedClientOp] == nil, @"/Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/channel/OperationChannel.java:216 condition failed: assert queue.unackedClientOp() == null;");
    break;
    case ComGoodowRealtimeStoreChannelOperationChannel_State_WAITING_ACK:
    NSAssert(!isMaybeSendTaskScheduled_, @"/Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/channel/OperationChannel.java:219 condition failed: assert !isMaybeSendTaskScheduled;");
    break;
    default:
    @throw [[JavaLangAssertionError alloc] initWithId:[NSString stringWithFormat:@"State %@ not implemented", state_]];
  }
}

- (BOOL)isClean {
  [self checkConnected];
  BOOL ret = ![((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) hasQueuedClientOps] && [queue_ unackedClientOp] == nil;
  NSAssert(!ret || state_ == ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_ACKED(), @"/Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/channel/OperationChannel.java:233 condition failed: assert !ret || state == State.ACKED;");
  return ret;
}

- (BOOL)isConnected {
  return state_ != ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_UNINITIALISED();
}

- (void)maybeEagerlyHandleAckWithDouble:(double)appliedAt {
  id<ComGoodowRealtimeOperationOperation> ownOp = [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) ackOpIfVersionMatchesWithDouble:appliedAt];
  if (ownOp == nil) {
    return;
  }
  [((JavaUtilLoggingLogger *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_logger_)) logWithJavaUtilLoggingLevel:JavaUtilLoggingLevel_get_INFO_() withNSString:[NSString stringWithFormat:@"Eagerly acked @%f", appliedAt]];
  [self acked];
  [((id<ComGoodowRealtimeStoreChannelOperationChannel_Listener>) nil_chk(listener_)) onAckWithId:ownOp withBoolean:[self isClean]];
}

- (void)maybeSend {
  if ([((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) unackedClientOp] != nil) {
    [((JavaUtilLoggingLogger *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_logger_)) logWithJavaUtilLoggingLevel:JavaUtilLoggingLevel_get_INFO_() withNSString:[NSString stringWithFormat:@"%@, Has 1 unacked...", state_]];
    return;
  }
  if ([queue_ hasQueuedClientOps]) {
    (void) [queue_ pushQueuedOpsToUnacked];
    [self sendUnackedOps];
  }
}

- (void)onAckOwnOperationWithDouble:(double)appliedAt
                             withId:(id<ComGoodowRealtimeOperationOperation>)ackedOp {
  BOOL alreadyAckedByXhr = [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) expectedAckWithDouble:appliedAt];
  if (alreadyAckedByXhr) {
    return;
  }
  [queue_ ackClientOpWithDouble:appliedAt];
  [((JavaUtilLoggingLogger *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_logger_)) logWithJavaUtilLoggingLevel:JavaUtilLoggingLevel_get_INFO_() withNSString:[NSString stringWithFormat:@"Ack @%f", appliedAt]];
  [self acked];
  [((id<ComGoodowRealtimeStoreChannelOperationChannel_Listener>) nil_chk(listener_)) onAckWithId:ackedOp withBoolean:[self isClean]];
}

- (void)onIncomingOperationWithDouble:(double)appliedAt
                               withId:(id<ComGoodowRealtimeOperationOperation>)operation {
  [((JavaUtilLoggingLogger *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_logger_)) logWithJavaUtilLoggingLevel:JavaUtilLoggingLevel_get_INFO_() withNSString:[NSString stringWithFormat:@"Incoming applied @%f %@", appliedAt, state_]];
  [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) serverOpWithDouble:appliedAt withId:operation];
  [((id<ComGoodowRealtimeStoreChannelOperationChannel_Listener>) nil_chk(listener_)) onRemoteOpWithId:operation];
}

- (void)sendUnackedOps {
  id<ComGoodowRealtimeOperationOperation> unackedClientOp = [((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) unackedClientOp];
  NSAssert(unackedClientOp != nil, @"/Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/channel/OperationChannel.java:298 condition failed: assert unackedClientOp != null;");
  [((JavaUtilLoggingLogger *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_logger_)) logWithJavaUtilLoggingLevel:JavaUtilLoggingLevel_get_INFO_() withNSString:[NSString stringWithFormat:@"Sending %@ @%f", unackedClientOp, [queue_ version__]]];
  id<ComGoodowRealtimeJsonJsonObject> delta = [((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([ComGoodowRealtimeJsonJson createObject])) setWithNSString:@"action" withId:@"post"])) setWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_ID_() withId:id__])) setWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_OP_DATA_() withId:[((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(((id<ComGoodowRealtimeJsonJsonObject>) check_protocol_cast([((id<ComGoodowRealtimeOperationOperation>) nil_chk(unackedClientOp)) toJson], @protocol(ComGoodowRealtimeJsonJsonObject))))) setWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_VERSION_() withDouble:[queue_ version__]]];
  (void) [((id<ComGoodowRealtimeChannelBus>) nil_chk(bus_)) sendWithNSString:ComGoodowRealtimeStoreChannelConstants_Topic_get_STORE_() withId:delta withComGoodowRealtimeCoreHandler:[[ComGoodowRealtimeStoreChannelOperationChannel_$3 alloc] initWithComGoodowRealtimeStoreChannelOperationChannel:self]];
  [self setStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_WAITING_ACK()];
}

- (void)setStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:(ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *)newState {
  ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *oldState = state_;
  NSAssert([((JavaUtilEnumSet *) nil_chk(((ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *) nil_chk(oldState))->to_)) containsWithId:newState], [[NSString stringWithFormat:@"Invalid state transition %@ -> %@" J2OBJC_COMMA() oldState J2OBJC_COMMA() newState] description]);
  [self checkStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:newState];
  state_ = newState;
  switch ([newState ordinal]) {
    case ComGoodowRealtimeStoreChannelOperationChannel_State_ACKED:
    if (oldState != ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_get_UNINITIALISED()) {
      [((id<ComGoodowRealtimeStoreChannelOperationChannel_Listener>) nil_chk(listener_)) onSaveStateChangedWithBoolean:NO withBoolean:[((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) hasQueuedClientOps]];
    }
    break;
    case ComGoodowRealtimeStoreChannelOperationChannel_State_WAITING_ACK:
    [((id<ComGoodowRealtimeStoreChannelOperationChannel_Listener>) nil_chk(listener_)) onSaveStateChangedWithBoolean:YES withBoolean:[((ComGoodowRealtimeStoreChannelTransformQueue *) nil_chk(queue_)) hasQueuedClientOps]];
    break;
    default:
    break;
  }
}

+ (void)initialize {
  if (self == [ComGoodowRealtimeStoreChannelOperationChannel class]) {
    ComGoodowRealtimeStoreChannelOperationChannel_logger_ = [JavaUtilLoggingLogger getLoggerWithNSString:[[IOSClass classWithClass:[ComGoodowRealtimeStoreChannelOperationChannel class]] getName]];
    ComGoodowRealtimeStoreChannelOperationChannel_initialized = YES;
  }
}

- (void)copyAllFieldsTo:(ComGoodowRealtimeStoreChannelOperationChannel *)other {
  [super copyAllFieldsTo:other];
  other->bus_ = bus_;
  other->handlerRegistration_ = handlerRegistration_;
  other->id__ = id__;
  other->isMaybeSendTaskScheduled_ = isMaybeSendTaskScheduled_;
  other->listener_ = listener_;
  other->maybeSendTask_ = maybeSendTask_;
  other->queue_ = queue_;
  other->state_ = state_;
  other->transformer_ = transformer_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "initWithNSString:withComGoodowRealtimeOperationTransformer:withComGoodowRealtimeChannelBus:withComGoodowRealtimeStoreChannelOperationChannel_Listener:", "OperationChannel", NULL, 0x1, NULL },
    { "connectWithDouble:", "connect", "V", 0x1, NULL },
    { "disconnect", NULL, "V", 0x1, NULL },
    { "peek", NULL, "TO;", 0x1, NULL },
    { "receive", NULL, "TO;", 0x1, NULL },
    { "sendWithId:", "send", "V", 0x1, NULL },
    { "version__", "version", "D", 0x1, NULL },
    { "acked", NULL, "V", 0x2, NULL },
    { "checkConnected", NULL, "V", 0x2, NULL },
    { "checkStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:", "checkState", "V", 0x2, NULL },
    { "isClean", NULL, "Z", 0x2, NULL },
    { "isConnected", NULL, "Z", 0x2, NULL },
    { "maybeEagerlyHandleAckWithDouble:", "maybeEagerlyHandleAck", "V", 0x2, NULL },
    { "maybeSend", NULL, "V", 0x2, NULL },
    { "onAckOwnOperationWithDouble:withId:", "onAckOwnOperation", "V", 0x2, NULL },
    { "onIncomingOperationWithDouble:withId:", "onIncomingOperation", "V", 0x2, NULL },
    { "sendUnackedOps", NULL, "V", 0x2, NULL },
    { "setStateWithComGoodowRealtimeStoreChannelOperationChannel_StateEnum:", "setState", "V", 0x2, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "isMaybeSendTaskScheduled_", NULL, 0x2, "Z", NULL,  },
    { "maybeSendTask_", NULL, 0x12, "Lcom.goodow.realtime.core.Handler;", NULL,  },
    { "logger_", NULL, 0x1a, "Ljava.util.logging.Logger;", &ComGoodowRealtimeStoreChannelOperationChannel_logger_,  },
    { "listener_", NULL, 0x12, "Lcom.goodow.realtime.store.channel.OperationChannel$Listener;", NULL,  },
    { "state_", NULL, 0x2, "Lcom.goodow.realtime.store.channel.OperationChannel$State;", NULL,  },
    { "queue_", NULL, 0x12, "Lcom.goodow.realtime.store.channel.TransformQueue;", NULL,  },
    { "id__", "id", 0x12, "Ljava.lang.String;", NULL,  },
    { "bus_", NULL, 0x12, "Lcom.goodow.realtime.channel.Bus;", NULL,  },
    { "handlerRegistration_", NULL, 0x2, "Lcom.goodow.realtime.core.Registration;", NULL,  },
    { "transformer_", NULL, 0x12, "Lcom.goodow.realtime.operation.Transformer;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreChannelOperationChannel = { "OperationChannel", "com.goodow.realtime.store.channel", NULL, 0x1, 18, methods, 10, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreChannelOperationChannel;
}

@end

@interface ComGoodowRealtimeStoreChannelOperationChannel_Listener : NSObject
@end

@implementation ComGoodowRealtimeStoreChannelOperationChannel_Listener

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "onAckWithId:withBoolean:", "onAck", "V", 0x401, NULL },
    { "onErrorWithJavaLangThrowable:", "onError", "V", 0x401, NULL },
    { "onRemoteOpWithId:", "onRemoteOp", "V", 0x401, NULL },
    { "onSaveStateChangedWithBoolean:withBoolean:", "onSaveStateChanged", "V", 0x401, NULL },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreChannelOperationChannel_Listener = { "Listener", "com.goodow.realtime.store.channel", "OperationChannel", 0x201, 4, methods, 0, NULL, 0, NULL};
  return &_ComGoodowRealtimeStoreChannelOperationChannel_Listener;
}

@end

BOOL ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_initialized = NO;

ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_values[3];

@implementation ComGoodowRealtimeStoreChannelOperationChannel_StateEnum

- (id)copyWithZone:(NSZone *)zone {
  return self;
}

- (void)transitionsToWithComGoodowRealtimeStoreChannelOperationChannel_StateEnumArray:(IOSObjectArray *)validTransitionStates {
  to_ = [JavaUtilEnumSet ofWithId:ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_UNINITIALISED withJavaLangEnumArray:validTransitionStates];
}

- (id)initWithNSString:(NSString *)__name withInt:(int)__ordinal {
  return [super initWithNSString:__name withInt:__ordinal];
}

+ (void)initialize {
  if (self == [ComGoodowRealtimeStoreChannelOperationChannel_StateEnum class]) {
    ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_UNINITIALISED = [[ComGoodowRealtimeStoreChannelOperationChannel_StateEnum alloc] initWithNSString:@"UNINITIALISED" withInt:0];
    ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_ACKED = [[ComGoodowRealtimeStoreChannelOperationChannel_StateEnum alloc] initWithNSString:@"ACKED" withInt:1];
    ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_WAITING_ACK = [[ComGoodowRealtimeStoreChannelOperationChannel_StateEnum alloc] initWithNSString:@"WAITING_ACK" withInt:2];
    {
[((ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_UNINITIALISED)) transitionsToWithComGoodowRealtimeStoreChannelOperationChannel_StateEnumArray:[IOSObjectArray arrayWithObjects:(id[]){ ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_ACKED } count:1 type:[IOSClass classWithClass:[ComGoodowRealtimeStoreChannelOperationChannel_StateEnum class]]]];
[((ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_ACKED)) transitionsToWithComGoodowRealtimeStoreChannelOperationChannel_StateEnumArray:[IOSObjectArray arrayWithObjects:(id[]){ ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_WAITING_ACK } count:1 type:[IOSClass classWithClass:[ComGoodowRealtimeStoreChannelOperationChannel_StateEnum class]]]];
[((ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *) nil_chk(ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_WAITING_ACK)) transitionsToWithComGoodowRealtimeStoreChannelOperationChannel_StateEnumArray:[IOSObjectArray arrayWithObjects:(id[]){ ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_ACKED } count:1 type:[IOSClass classWithClass:[ComGoodowRealtimeStoreChannelOperationChannel_StateEnum class]]]];
}
    ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_initialized = YES;
  }
}

+ (IOSObjectArray *)values {
  return [IOSObjectArray arrayWithObjects:ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_values count:3 type:[IOSClass classWithClass:[ComGoodowRealtimeStoreChannelOperationChannel_StateEnum class]]];
}

+ (ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *)valueOfWithNSString:(NSString *)name {
  for (int i = 0; i < 3; i++) {
    ComGoodowRealtimeStoreChannelOperationChannel_StateEnum *e = ComGoodowRealtimeStoreChannelOperationChannel_StateEnum_values[i];
    if ([name isEqual:[e name]]) {
      return e;
    }
  }
  @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:name];
  return nil;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "transitionsToWithComGoodowRealtimeStoreChannelOperationChannel_StateEnumArray:", "transitionsTo", "V", 0x82, NULL },
    { "init", NULL, NULL, 0x0, NULL },
  };
  static const char *superclass_type_args[] = {"Lcom.goodow.realtime.store.channel.OperationChannel$State;"};
  static J2ObjcClassInfo _ComGoodowRealtimeStoreChannelOperationChannel_StateEnum = { "State", "com.goodow.realtime.store.channel", "OperationChannel", 0x4018, 2, methods, 0, NULL, 1, superclass_type_args};
  return &_ComGoodowRealtimeStoreChannelOperationChannel_StateEnum;
}

@end

@implementation ComGoodowRealtimeStoreChannelOperationChannel_$1

- (void)handleWithId:(id)ignore {
  this$0_->isMaybeSendTaskScheduled_ = NO;
  [this$0_ maybeSend];
}

- (id)initWithComGoodowRealtimeStoreChannelOperationChannel:(ComGoodowRealtimeStoreChannelOperationChannel *)outer$ {
  this$0_ = outer$;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "handleWithJavaLangVoid:", "handle", "V", 0x1, NULL },
    { "initWithComGoodowRealtimeStoreChannelOperationChannel:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.goodow.realtime.store.channel.OperationChannel;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreChannelOperationChannel_$1 = { "$1", "com.goodow.realtime.store.channel", "OperationChannel", 0x8000, 2, methods, 1, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreChannelOperationChannel_$1;
}

@end

@implementation ComGoodowRealtimeStoreChannelOperationChannel_$2

- (void)handleWithId:(id<ComGoodowRealtimeChannelMessage>)message {
  if (![this$0_ isConnected]) {
    return;
  }
  id<ComGoodowRealtimeJsonJsonObject> body = [((id<ComGoodowRealtimeChannelMessage>) nil_chk(message)) body];
  id<ComGoodowRealtimeOperationOperation> op = [((id<ComGoodowRealtimeOperationTransformer>) nil_chk(this$0_->transformer_)) createOperationWithComGoodowRealtimeJsonJsonObject:body];
  double appliedAt = [((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(body)) getNumberWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_VERSION_()];
  if ([((NSString *) nil_chk([((id<ComGoodowRealtimeChannelBus>) nil_chk(this$0_->bus_)) getSessionId])) isEqual:[body getStringWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_SESSION_ID_()]]) {
    [this$0_ onAckOwnOperationWithDouble:appliedAt withId:op];
  }
  else {
    [this$0_ onIncomingOperationWithDouble:appliedAt withId:op];
  }
}

- (id)initWithComGoodowRealtimeStoreChannelOperationChannel:(ComGoodowRealtimeStoreChannelOperationChannel *)outer$ {
  this$0_ = outer$;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "handleWithComGoodowRealtimeChannelMessage:", "handle", "V", 0x1, NULL },
    { "initWithComGoodowRealtimeStoreChannelOperationChannel:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.goodow.realtime.store.channel.OperationChannel;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreChannelOperationChannel_$2 = { "$2", "com.goodow.realtime.store.channel", "OperationChannel", 0x8000, 2, methods, 1, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreChannelOperationChannel_$2;
}

@end

@implementation ComGoodowRealtimeStoreChannelOperationChannel_$3

- (void)handleWithId:(id<ComGoodowRealtimeChannelMessage>)message {
  if (![this$0_ isConnected]) {
    return;
  }
  [this$0_ maybeEagerlyHandleAckWithDouble:[((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([((id<ComGoodowRealtimeChannelMessage>) nil_chk(message)) body])) getNumberWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_VERSION_()]];
}

- (id)initWithComGoodowRealtimeStoreChannelOperationChannel:(ComGoodowRealtimeStoreChannelOperationChannel *)outer$ {
  this$0_ = outer$;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "handleWithComGoodowRealtimeChannelMessage:", "handle", "V", 0x1, NULL },
    { "initWithComGoodowRealtimeStoreChannelOperationChannel:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.goodow.realtime.store.channel.OperationChannel;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreChannelOperationChannel_$3 = { "$3", "com.goodow.realtime.store.channel", "OperationChannel", 0x8000, 2, methods, 1, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreChannelOperationChannel_$3;
}

@end
