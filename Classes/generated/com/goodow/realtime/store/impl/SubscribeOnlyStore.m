//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/impl/SubscribeOnlyStore.java
//
//  Created by retechretech.
//

#include "com/goodow/realtime/channel/Bus.h"
#include "com/goodow/realtime/channel/Message.h"
#include "com/goodow/realtime/channel/impl/BusProxy.h"
#include "com/goodow/realtime/channel/impl/ReconnectBus.h"
#include "com/goodow/realtime/channel/impl/ReliableSubscribeBus.h"
#include "com/goodow/realtime/channel/impl/WebSocketBus.h"
#include "com/goodow/realtime/core/Handler.h"
#include "com/goodow/realtime/core/Platform.h"
#include "com/goodow/realtime/core/Registration.h"
#include "com/goodow/realtime/core/Scheduler.h"
#include "com/goodow/realtime/json/Json.h"
#include "com/goodow/realtime/json/JsonArray.h"
#include "com/goodow/realtime/json/JsonObject.h"
#include "com/goodow/realtime/operation/Transformer.h"
#include "com/goodow/realtime/operation/impl/CollaborativeOperation.h"
#include "com/goodow/realtime/operation/impl/CollaborativeTransformer.h"
#include "com/goodow/realtime/store/Document.h"
#include "com/goodow/realtime/store/Model.h"
#include "com/goodow/realtime/store/Store.h"
#include "com/goodow/realtime/store/channel/Constants.h"
#include "com/goodow/realtime/store/impl/DocumentBridge.h"
#include "com/goodow/realtime/store/impl/SubscribeOnlyStore.h"

@implementation ComGoodowRealtimeStoreImplSubscribeOnlyStore

- (id)initComGoodowRealtimeStoreImplSubscribeOnlyStoreWithComGoodowRealtimeChannelBus:(id<ComGoodowRealtimeChannelBus>)bus {
  return [super initWithComGoodowRealtimeChannelBus:bus];
}

- (id)initWithComGoodowRealtimeChannelBus:(id<ComGoodowRealtimeChannelBus>)bus {
  return [self initComGoodowRealtimeStoreImplSubscribeOnlyStoreWithComGoodowRealtimeChannelBus:bus];
}

- (id)initWithNSString:(NSString *)serverAddress
withComGoodowRealtimeJsonJsonObject:(id<ComGoodowRealtimeJsonJsonObject>)options {
  return [self initComGoodowRealtimeStoreImplSubscribeOnlyStoreWithComGoodowRealtimeChannelBus:[[ComGoodowRealtimeChannelImplReliableSubscribeBus alloc] initWithComGoodowRealtimeChannelBus:[[ComGoodowRealtimeChannelImplReconnectBus alloc] initWithNSString:serverAddress withComGoodowRealtimeJsonJsonObject:options] withComGoodowRealtimeJsonJsonObject:options]];
}

- (id<ComGoodowRealtimeStoreStore>)authorizeWithNSString:(NSString *)userId
                                            withNSString:(NSString *)sessionId {
  self->userId__ = userId;
  self->sessionId__ = sessionId;
  return self;
}

- (void)load__WithNSString:(NSString *)id_
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)onLoaded
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)opt_initializer
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)opt_error {
  if (sessionId__ == nil) {
    ComGoodowRealtimeChannelImplWebSocketBus *webSocketBus = nil;
    if ([(id) bus_ isKindOfClass:[ComGoodowRealtimeChannelImplWebSocketBus class]]) {
      webSocketBus = (ComGoodowRealtimeChannelImplWebSocketBus *) check_class_cast(bus_, [ComGoodowRealtimeChannelImplWebSocketBus class]);
    }
    else if ([(id) bus_ isKindOfClass:[ComGoodowRealtimeChannelImplBusProxy class]] && [(id) [((ComGoodowRealtimeChannelImplBusProxy *) nil_chk(((ComGoodowRealtimeChannelImplBusProxy *) check_class_cast(bus_, [ComGoodowRealtimeChannelImplBusProxy class])))) getDelegate] isKindOfClass:[ComGoodowRealtimeChannelImplWebSocketBus class]]) {
      webSocketBus = (ComGoodowRealtimeChannelImplWebSocketBus *) check_class_cast([((ComGoodowRealtimeChannelImplBusProxy *) nil_chk(((ComGoodowRealtimeChannelImplBusProxy *) check_class_cast(bus_, [ComGoodowRealtimeChannelImplBusProxy class])))) getDelegate], [ComGoodowRealtimeChannelImplWebSocketBus class]);
    }
    if (webSocketBus != nil) {
      [webSocketBus loginWithNSString:@"" withNSString:@"" withComGoodowRealtimeCoreHandler:[[ComGoodowRealtimeStoreImplSubscribeOnlyStore_$1 alloc] initWithComGoodowRealtimeStoreImplSubscribeOnlyStore:self withNSString:id_ withComGoodowRealtimeCoreHandler:onLoaded withComGoodowRealtimeCoreHandler:opt_initializer withComGoodowRealtimeCoreHandler:opt_error]];
      return;
    }
  }
  [self doLoadWithNSString:id_ withComGoodowRealtimeCoreHandler:onLoaded withComGoodowRealtimeCoreHandler:opt_initializer withComGoodowRealtimeCoreHandler:opt_error];
}

- (void)onLoadedWithNSString:(NSString *)id_
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)opt_initializer
withComGoodowRealtimeJsonJsonObject:(id<ComGoodowRealtimeJsonJsonObject>)snapshot
withComGoodowRealtimeStoreImplDocumentBridge:(ComGoodowRealtimeStoreImplDocumentBridge *)bridge {
  NSString *address = [NSString stringWithFormat:@"%@:%@", ComGoodowRealtimeStoreChannelConstants_Addr_get_STORE_(), id_];
  if ([(id) bus_ isKindOfClass:[ComGoodowRealtimeChannelImplReliableSubscribeBus class]]) {
    [((ComGoodowRealtimeChannelImplReliableSubscribeBus *) nil_chk(((ComGoodowRealtimeChannelImplReliableSubscribeBus *) check_class_cast(bus_, [ComGoodowRealtimeChannelImplReliableSubscribeBus class])))) synchronizeSequenceNumberWithNSString:address withDouble:[((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(snapshot)) getNumberWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_VERSION_()] - 1];
  }
  id<ComGoodowRealtimeCoreRegistration> handlerReg = [((id<ComGoodowRealtimeChannelBus>) nil_chk(bus_)) registerHandlerWithNSString:address withComGoodowRealtimeCoreHandler:[[ComGoodowRealtimeStoreImplSubscribeOnlyStore_$2 alloc] initWithComGoodowRealtimeStoreImplDocumentBridge:bridge]];
  [((ComGoodowRealtimeStoreImplDocumentBridge *) nil_chk(bridge)) setOutputSinkWithComGoodowRealtimeStoreImplDocumentBridge_OutputSink:[[ComGoodowRealtimeStoreImplSubscribeOnlyStore_$3 alloc] initWithComGoodowRealtimeCoreRegistration:handlerReg]];
}

- (void)doLoadWithNSString:(NSString *)id_
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)onLoaded
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)opt_initializer
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)opt_error {
  (void) [((id<ComGoodowRealtimeChannelBus>) nil_chk(bus_)) sendWithNSString:ComGoodowRealtimeStoreChannelConstants_Addr_get_STORE_() withId:[((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([ComGoodowRealtimeJsonJson createObject])) setWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_ID_() withId:id_] withComGoodowRealtimeCoreHandler:[[ComGoodowRealtimeStoreImplSubscribeOnlyStore_$4 alloc] initWithComGoodowRealtimeStoreImplSubscribeOnlyStore:self withNSString:id_ withComGoodowRealtimeCoreHandler:opt_error withComGoodowRealtimeCoreHandler:opt_initializer withComGoodowRealtimeCoreHandler:onLoaded]];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "initWithComGoodowRealtimeChannelBus:", "SubscribeOnlyStore", NULL, 0x1, NULL },
    { "initWithNSString:withComGoodowRealtimeJsonJsonObject:", "SubscribeOnlyStore", NULL, 0x1, NULL },
    { "authorizeWithNSString:withNSString:", "authorize", "Lcom.goodow.realtime.store.Store;", 0x1, NULL },
    { "load__WithNSString:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:", "load", "V", 0x1, NULL },
    { "onLoadedWithNSString:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeJsonJsonObject:withComGoodowRealtimeStoreImplDocumentBridge:", "onLoaded", "V", 0x4, NULL },
    { "doLoadWithNSString:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:", "doLoad", "V", 0x2, NULL },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreImplSubscribeOnlyStore = { "SubscribeOnlyStore", "com.goodow.realtime.store.impl", NULL, 0x1, 6, methods, 0, NULL, 0, NULL};
  return &_ComGoodowRealtimeStoreImplSubscribeOnlyStore;
}

@end

@implementation ComGoodowRealtimeStoreImplSubscribeOnlyStore_$1

- (void)handleWithId:(id<ComGoodowRealtimeJsonJsonObject>)msg {
  this$0_->sessionId__ = [((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(msg)) getStringWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_SESSION_ID_()];
  this$0_->userId__ = [msg getStringWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_USER_ID_()];
  [this$0_ doLoadWithNSString:val$id_ withComGoodowRealtimeCoreHandler:val$onLoaded_ withComGoodowRealtimeCoreHandler:val$opt_initializer_ withComGoodowRealtimeCoreHandler:val$opt_error_];
}

- (id)initWithComGoodowRealtimeStoreImplSubscribeOnlyStore:(ComGoodowRealtimeStoreImplSubscribeOnlyStore *)outer$
                                              withNSString:(NSString *)capture$0
                          withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)capture$1
                          withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)capture$2
                          withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)capture$3 {
  this$0_ = outer$;
  val$id_ = capture$0;
  val$onLoaded_ = capture$1;
  val$opt_initializer_ = capture$2;
  val$opt_error_ = capture$3;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "handleWithComGoodowRealtimeJsonJsonObject:", "handle", "V", 0x1, NULL },
    { "initWithComGoodowRealtimeStoreImplSubscribeOnlyStore:withNSString:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.goodow.realtime.store.impl.SubscribeOnlyStore;", NULL,  },
    { "val$id_", NULL, 0x1012, "Ljava.lang.String;", NULL,  },
    { "val$onLoaded_", NULL, 0x1012, "Lcom.goodow.realtime.core.Handler;", NULL,  },
    { "val$opt_initializer_", NULL, 0x1012, "Lcom.goodow.realtime.core.Handler;", NULL,  },
    { "val$opt_error_", NULL, 0x1012, "Lcom.goodow.realtime.core.Handler;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreImplSubscribeOnlyStore_$1 = { "$1", "com.goodow.realtime.store.impl", "SubscribeOnlyStore", 0x8000, 2, methods, 5, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreImplSubscribeOnlyStore_$1;
}

@end

@implementation ComGoodowRealtimeStoreImplSubscribeOnlyStore_$2

- (void)handleWithId:(id<ComGoodowRealtimeChannelMessage>)message {
  id<ComGoodowRealtimeJsonJsonObject> body = [((id<ComGoodowRealtimeChannelMessage>) nil_chk(message)) body];
  ComGoodowRealtimeOperationImplCollaborativeOperation *op = [((id<ComGoodowRealtimeOperationTransformer>) nil_chk(transformer_)) createOperationWithComGoodowRealtimeJsonJsonObject:body];
  [((ComGoodowRealtimeStoreImplDocumentBridge *) nil_chk(val$bridge_)) consumeWithId:op];
}

- (id)initWithComGoodowRealtimeStoreImplDocumentBridge:(ComGoodowRealtimeStoreImplDocumentBridge *)capture$0 {
  val$bridge_ = capture$0;
  if (self = [super init]) {
    transformer_ = [[ComGoodowRealtimeOperationImplCollaborativeTransformer alloc] init];
  }
  return self;
}

- (void)copyAllFieldsTo:(ComGoodowRealtimeStoreImplSubscribeOnlyStore_$2 *)other {
  [super copyAllFieldsTo:other];
  other->transformer_ = transformer_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "handleWithComGoodowRealtimeChannelMessage:", "handle", "V", 0x1, NULL },
    { "initWithComGoodowRealtimeStoreImplDocumentBridge:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "transformer_", NULL, 0x0, "Lcom.goodow.realtime.operation.Transformer;", NULL,  },
    { "val$bridge_", NULL, 0x1012, "Lcom.goodow.realtime.store.impl.DocumentBridge;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreImplSubscribeOnlyStore_$2 = { "$2", "com.goodow.realtime.store.impl", "SubscribeOnlyStore", 0x8000, 2, methods, 2, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreImplSubscribeOnlyStore_$2;
}

@end

@implementation ComGoodowRealtimeStoreImplSubscribeOnlyStore_$3

- (void)close {
  [((id<ComGoodowRealtimeCoreRegistration>) nil_chk(val$handlerReg_)) unregister];
}

- (void)consumeWithId:(ComGoodowRealtimeOperationImplCollaborativeOperation *)op {
}

- (id)initWithComGoodowRealtimeCoreRegistration:(id<ComGoodowRealtimeCoreRegistration>)capture$0 {
  val$handlerReg_ = capture$0;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "close", NULL, "V", 0x1, NULL },
    { "consumeWithComGoodowRealtimeOperationImplCollaborativeOperation:", "consume", "V", 0x1, NULL },
    { "initWithComGoodowRealtimeCoreRegistration:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "val$handlerReg_", NULL, 0x1012, "Lcom.goodow.realtime.core.Registration;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreImplSubscribeOnlyStore_$3 = { "$3", "com.goodow.realtime.store.impl", "SubscribeOnlyStore", 0x8000, 3, methods, 1, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreImplSubscribeOnlyStore_$3;
}

@end

@implementation ComGoodowRealtimeStoreImplSubscribeOnlyStore_$4

- (void)handleWithId:(id<ComGoodowRealtimeChannelMessage>)message {
  id<ComGoodowRealtimeJsonJsonObject> body = [((id<ComGoodowRealtimeChannelMessage>) nil_chk(message)) body];
  body = body == nil ? [((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([ComGoodowRealtimeJsonJson createObject])) setWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_VERSION_() withDouble:0] : body;
  ComGoodowRealtimeStoreImplDocumentBridge *bridge = [[ComGoodowRealtimeStoreImplDocumentBridge alloc] initWithComGoodowRealtimeStoreStore:this$0_ withNSString:val$id_ withComGoodowRealtimeJsonJsonArray:body == nil ? nil : [body getArrayWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_SNAPSHOT_()] withComGoodowRealtimeCoreHandler:val$opt_error_];
  [this$0_ onLoadedWithNSString:val$id_ withComGoodowRealtimeCoreHandler:val$opt_initializer_ withComGoodowRealtimeJsonJsonObject:body withComGoodowRealtimeStoreImplDocumentBridge:bridge];
  if ([body getNumberWithNSString:ComGoodowRealtimeStoreChannelConstants_Key_get_VERSION_()] == 0) {
    [bridge createRoot];
    if (val$opt_initializer_ != nil) {
      [((id<ComGoodowRealtimeCoreScheduler>) nil_chk([ComGoodowRealtimeCorePlatform scheduler])) handleWithId:val$opt_initializer_ withId:[((id<ComGoodowRealtimeStoreDocument>) nil_chk([bridge getDocument])) getModel]];
    }
  }
  [bridge scheduleHandleWithComGoodowRealtimeCoreHandler:val$onLoaded_ withId:[bridge getDocument]];
}

- (id)initWithComGoodowRealtimeStoreImplSubscribeOnlyStore:(ComGoodowRealtimeStoreImplSubscribeOnlyStore *)outer$
                                              withNSString:(NSString *)capture$0
                          withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)capture$1
                          withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)capture$2
                          withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)capture$3 {
  this$0_ = outer$;
  val$id_ = capture$0;
  val$opt_error_ = capture$1;
  val$opt_initializer_ = capture$2;
  val$onLoaded_ = capture$3;
  return [super init];
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "handleWithComGoodowRealtimeChannelMessage:", "handle", "V", 0x1, NULL },
    { "initWithComGoodowRealtimeStoreImplSubscribeOnlyStore:withNSString:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:withComGoodowRealtimeCoreHandler:", "init", NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.goodow.realtime.store.impl.SubscribeOnlyStore;", NULL,  },
    { "val$id_", NULL, 0x1012, "Ljava.lang.String;", NULL,  },
    { "val$opt_error_", NULL, 0x1012, "Lcom.goodow.realtime.core.Handler;", NULL,  },
    { "val$opt_initializer_", NULL, 0x1012, "Lcom.goodow.realtime.core.Handler;", NULL,  },
    { "val$onLoaded_", NULL, 0x1012, "Lcom.goodow.realtime.core.Handler;", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreImplSubscribeOnlyStore_$4 = { "$4", "com.goodow.realtime.store.impl", "SubscribeOnlyStore", 0x8000, 2, methods, 5, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreImplSubscribeOnlyStore_$4;
}

@end
