//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/impl/IndexReferenceImpl.java
//
//  Created by retechretech.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/goodow/realtime/core/Handler.h"
#include "com/goodow/realtime/core/Registration.h"
#include "com/goodow/realtime/json/Json.h"
#include "com/goodow/realtime/json/JsonObject.h"
#include "com/goodow/realtime/operation/OperationComponent.h"
#include "com/goodow/realtime/operation/create/CreateComponent.h"
#include "com/goodow/realtime/operation/cursor/ReferenceShiftedComponent.h"
#include "com/goodow/realtime/store/CollaborativeObject.h"
#include "com/goodow/realtime/store/EventType.h"
#include "com/goodow/realtime/store/ReferenceShiftedEvent.h"
#include "com/goodow/realtime/store/impl/CollaborativeObjectImpl.h"
#include "com/goodow/realtime/store/impl/IndexReferenceImpl.h"
#include "com/goodow/realtime/store/impl/ModelImpl.h"
#include "com/goodow/realtime/store/impl/ReferenceShiftedEventImpl.h"

@implementation ComGoodowRealtimeStoreImplIndexReferenceImpl

- (id)initWithComGoodowRealtimeStoreImplModelImpl:(ComGoodowRealtimeStoreImplModelImpl *)model {
  if (self = [super initWithComGoodowRealtimeStoreImplModelImpl:model]) {
    index__ = -1;
  }
  return self;
}

- (id<ComGoodowRealtimeCoreRegistration>)onReferenceShiftedWithComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  return [self addEventListenerWithComGoodowRealtimeStoreEventTypeEnum:ComGoodowRealtimeStoreEventTypeEnum_get_REFERENCE_SHIFTED() withComGoodowRealtimeCoreHandler:handler withBoolean:NO];
}

- (BOOL)canBeDeleted {
  return canBeDeleted__;
}

- (int)index {
  return index__;
}

- (id)referencedObject {
  return [((ComGoodowRealtimeStoreImplModelImpl *) nil_chk(model_)) getObjectWithNSString:referencedObjectId_];
}

- (void)setIndexWithInt:(int)index {
  if (index == self->index__) {
    return;
  }
  ComGoodowRealtimeOperationCursorReferenceShiftedComponent *op = [[ComGoodowRealtimeOperationCursorReferenceShiftedComponent alloc] initWithNSString:id__ withNSString:referencedObjectId_ withInt:index withBoolean:canBeDeleted__ withInt:self->index__];
  [self consumeAndSubmitWithComGoodowRealtimeOperationOperationComponent:op];
}

- (id<ComGoodowRealtimeJsonJsonObject>)toJson {
  id<ComGoodowRealtimeJsonJsonObject> json = [ComGoodowRealtimeJsonJson createObject];
  (void) [((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(json)) setWithNSString:@"id" withId:id__])) setWithNSString:@"referencedObjectId" withId:referencedObjectId_])) setWithNSString:@"index" withDouble:index__])) setWithNSString:@"canBeDeleted" withBoolean:canBeDeleted__];
  return json;
}

- (void)consumeWithNSString:(NSString *)userId
               withNSString:(NSString *)sessionId
withComGoodowRealtimeOperationOperationComponent:(ComGoodowRealtimeOperationOperationComponent *)component {
  ComGoodowRealtimeOperationCursorReferenceShiftedComponent *op = (ComGoodowRealtimeOperationCursorReferenceShiftedComponent *) check_class_cast(component, [ComGoodowRealtimeOperationCursorReferenceShiftedComponent class]);
  NSAssert(((ComGoodowRealtimeOperationCursorReferenceShiftedComponent *) nil_chk(op))->oldIndex_ == [self index], @"/Users/retechretech/dev/workspace/realtime/realtime-store/src/main/java/com/goodow/realtime/store/impl/IndexReferenceImpl.java:77 condition failed: assert op.oldIndex == index();");
  referencedObjectId_ = op->referencedObjectId_;
  index__ = op->newIndex_;
  canBeDeleted__ = op->canBeDeleted_;
  if (op->oldIndex_ != -1) {
    id<ComGoodowRealtimeStoreReferenceShiftedEvent> event = [[ComGoodowRealtimeStoreImplReferenceShiftedEventImpl alloc] initWithComGoodowRealtimeJsonJsonObject:[((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([((id<ComGoodowRealtimeJsonJsonObject>) nil_chk([self eventWithNSString:sessionId withNSString:userId])) setWithNSString:@"oldIndex" withDouble:op->oldIndex_])) setWithNSString:@"newIndex" withDouble:op->newIndex_]];
    [self fireEventWithComGoodowRealtimeStoreBaseModelEvent:event];
  }
}

- (void)setIndexWithBoolean:(BOOL)isInsert
                    withInt:(int)index
                    withInt:(int)length
               withNSString:(NSString *)sessionId
               withNSString:(NSString *)userId {
  int cursor = [self index];
  if (cursor < index) {
    return;
  }
  int newIndex = -2;
  if (isInsert) {
    newIndex = cursor + length;
  }
  else {
    if (cursor < index + length) {
      if (canBeDeleted__) {
        newIndex = -1;
      }
      else {
        newIndex = index;
      }
    }
    else {
      newIndex = cursor - length;
    }
  }
  ComGoodowRealtimeOperationCursorReferenceShiftedComponent *op = [[ComGoodowRealtimeOperationCursorReferenceShiftedComponent alloc] initWithNSString:id__ withNSString:referencedObjectId_ withInt:newIndex withBoolean:canBeDeleted__ withInt:cursor];
  [self consumeWithNSString:userId withNSString:sessionId withComGoodowRealtimeOperationOperationComponent:op];
}

- (IOSObjectArray *)toInitialization {
  ComGoodowRealtimeOperationCursorReferenceShiftedComponent *op = [[ComGoodowRealtimeOperationCursorReferenceShiftedComponent alloc] initWithNSString:id__ withNSString:referencedObjectId_ withInt:index__ withBoolean:canBeDeleted__ withInt:index__];
  return [IOSObjectArray arrayWithObjects:(id[]){ [[ComGoodowRealtimeOperationCreateCreateComponent alloc] initWithNSString:id__ withInt:ComGoodowRealtimeOperationCreateCreateComponent_INDEX_REFERENCE], op } count:2 type:[IOSClass classWithClass:[ComGoodowRealtimeOperationOperationComponent class]]];
}

- (void)copyAllFieldsTo:(ComGoodowRealtimeStoreImplIndexReferenceImpl *)other {
  [super copyAllFieldsTo:other];
  other->canBeDeleted__ = canBeDeleted__;
  other->index__ = index__;
  other->referencedObjectId_ = referencedObjectId_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "initWithComGoodowRealtimeStoreImplModelImpl:", "IndexReferenceImpl", NULL, 0x0, NULL },
    { "onReferenceShiftedWithComGoodowRealtimeCoreHandler:", "onReferenceShifted", "Lcom.goodow.realtime.core.Registration;", 0x1, NULL },
    { "canBeDeleted", NULL, "Z", 0x1, NULL },
    { "index", NULL, "I", 0x1, NULL },
    { "referencedObject", NULL, "TT;", 0x1, NULL },
    { "setIndexWithInt:", "setIndex", "V", 0x1, NULL },
    { "toJson", NULL, "Lcom.goodow.realtime.json.JsonObject;", 0x1, NULL },
    { "consumeWithNSString:withNSString:withComGoodowRealtimeOperationOperationComponent:", "consume", "V", 0x4, NULL },
    { "setIndexWithBoolean:withInt:withInt:withNSString:withNSString:", "setIndex", "V", 0x0, NULL },
    { "toInitialization", NULL, "[Lcom.goodow.realtime.operation.OperationComponent;", 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "referencedObjectId_", NULL, 0x2, "Ljava.lang.String;", NULL,  },
    { "index__", "index", 0x2, "I", NULL,  },
    { "canBeDeleted__", "canBeDeleted", 0x2, "Z", NULL,  },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeStoreImplIndexReferenceImpl = { "IndexReferenceImpl", "com.goodow.realtime.store.impl", NULL, 0x0, 10, methods, 3, fields, 0, NULL};
  return &_ComGoodowRealtimeStoreImplIndexReferenceImpl;
}

@end
