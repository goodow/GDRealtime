//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: src/main/java/com/goodow/realtime/IndexReference.java
//
//  Created by retechretech on 13-5-25.
//

#import "IOSObjectArray.h"
#import "com/goodow/realtime/CollaborativeObject.h"
#import "com/goodow/realtime/EventHandler.h"
#import "com/goodow/realtime/EventType.h"
#import "com/goodow/realtime/IndexReference.h"
#import "com/goodow/realtime/Model.h"
#import "com/goodow/realtime/ReferenceShiftedEvent.h"
#import "com/goodow/realtime/operation/CreateOperation.h"
#import "com/goodow/realtime/operation/Operation.h"
#import "com/goodow/realtime/operation/RealtimeOperation.h"
#import "com/goodow/realtime/operation/ReferenceShiftedOperation.h"
#import "com/goodow/realtime/util/ModelFactory.h"
#import "java/lang/StringBuilder.h"
#import "java/util/Set.h"

@implementation GDRIndexReference

@synthesize referencedObject_ = referencedObject__;
@synthesize index_ = index__;
@synthesize canBeDeleted_ = canBeDeleted__;

- (id)initWithGDRModel:(GDRModel *)model {
  if ((self = [super initWithGDRModel:model])) {
    index__ = -1;
  }
  return self;
}

- (void)addReferenceShiftedListenerWithGDREventHandler:(id<GDREventHandler>)handler {
  [self addEventListenerWithGDREventTypeEnum:[GDREventTypeEnum REFERENCE_SHIFTED] withGDREventHandler:handler withBOOL:NO];
}

- (BOOL)canBeDeleted {
  return canBeDeleted__;
}

- (int)index {
  return index__;
}

- (GDRCollaborativeObject *)referencedObject {
  return [((GDRModel *) NIL_CHK(model_)) getObjectWithNSString:referencedObject__];
}

- (void)removeReferenceShiftedListenerWithGDREventHandler:(id<GDREventHandler>)handler {
  [self removeEventListenerWithGDREventTypeEnum:[GDREventTypeEnum REFERENCE_SHIFTED] withGDREventHandler:handler withBOOL:NO];
}

- (void)setIndex:(int)index {
  if (index == self.index_) {
    return;
  }
  ComGoodowRealtimeOperationReferenceShiftedOperation *op = [[ComGoodowRealtimeOperationReferenceShiftedOperation alloc] initWithNSString:referencedObject__ withInt:index withBOOL:canBeDeleted__ withInt:self.index_];
  [self consumeAndSubmitWithComGoodowRealtimeOperationOperation:op];
}

- (void)consumeWithComGoodowRealtimeOperationRealtimeOperation:(ComGoodowRealtimeOperationRealtimeOperation *)operation {
  ComGoodowRealtimeOperationReferenceShiftedOperation *op = (ComGoodowRealtimeOperationReferenceShiftedOperation *) ((id<ComGoodowRealtimeOperationOperation>) [((ComGoodowRealtimeOperationRealtimeOperation *) NIL_CHK(operation)) getOp]);
  NSAssert(((ComGoodowRealtimeOperationReferenceShiftedOperation *) NIL_CHK(op)).oldIndex == [self index], @"src/main/java/com/goodow/realtime/IndexReference.java:146 condition failed: assert op.oldIndex == index();");
  GDRReferenceShiftedEvent *event = [[GDRReferenceShiftedEvent alloc] initWithGDRIndexReference:self withInt:((ComGoodowRealtimeOperationReferenceShiftedOperation *) NIL_CHK(op)).oldIndex withInt:((ComGoodowRealtimeOperationReferenceShiftedOperation *) NIL_CHK(op)).newIndex withNSString:((ComGoodowRealtimeOperationRealtimeOperation *) NIL_CHK(operation)).sessionId withNSString:((ComGoodowRealtimeOperationRealtimeOperation *) NIL_CHK(operation)).userId];
  referencedObject__ = ((ComGoodowRealtimeOperationReferenceShiftedOperation *) NIL_CHK(op)).referencedObject;
  index__ = ((ComGoodowRealtimeOperationReferenceShiftedOperation *) NIL_CHK(op)).newIndex;
  canBeDeleted__ = ((ComGoodowRealtimeOperationReferenceShiftedOperation *) NIL_CHK(op)).canBeDeleted;
  [self fireEventWithGDRBaseModelEvent:event];
}

- (void)setIndexWithBOOL:(BOOL)isInsert
                 withInt:(int)index
                 withInt:(int)length
            withNSString:(NSString *)sessionId
            withNSString:(NSString *)userId {
  int cursor = [self index];
  if (cursor < index) {
    return;
  }
  int newIndex = -2;
  if (isInsert) {
    newIndex = cursor + length;
  }
  else {
    if (cursor < index + length) {
      if (canBeDeleted__) {
        newIndex = -1;
      }
      else {
        newIndex = index;
      }
    }
    else {
      newIndex = cursor - length;
    }
  }
  ComGoodowRealtimeOperationReferenceShiftedOperation *op = [[ComGoodowRealtimeOperationReferenceShiftedOperation alloc] initWithNSString:referencedObject__ withInt:newIndex withBOOL:canBeDeleted__ withInt:cursor];
  [((ComGoodowRealtimeOperationReferenceShiftedOperation *) NIL_CHK(op)) setIdWithNSString:id__];
  ComGoodowRealtimeOperationRealtimeOperation *operation = [[ComGoodowRealtimeOperationRealtimeOperation alloc] initWithComGoodowRealtimeOperationOperation:op withNSString:userId withNSString:sessionId];
  [self consumeWithComGoodowRealtimeOperationRealtimeOperation:operation];
}

- (IOSObjectArray *)toInitialization {
  ComGoodowRealtimeOperationReferenceShiftedOperation *op = [[ComGoodowRealtimeOperationReferenceShiftedOperation alloc] initWithNSString:referencedObject__ withInt:index__ withBOOL:canBeDeleted__ withInt:index__];
  return [IOSObjectArray arrayWithObjects:(id[]){ [[ComGoodowRealtimeOperationCreateOperation alloc] initWithInt:ComGoodowRealtimeOperationCreateOperation_INDEX_REFERENCE withNSString:id__], op } count:2 type:[IOSClass classWithProtocol:@protocol(ComGoodowRealtimeOperationOperation)]];
}

- (void)toStringWithJavaUtilSet:(id<JavaUtilSet>)seen
      withJavaLangStringBuilder:(JavaLangStringBuilder *)sb {
  if ([((id<JavaUtilSet>) NIL_CHK(seen)) containsWithId:id__]) {
    [[[((JavaLangStringBuilder *) NIL_CHK(sb)) appendWithNSString:@"<IndexReference: "] appendWithNSString:id__] appendWithNSString:@">"];
    return;
  }
  [((id<JavaUtilSet>) NIL_CHK(seen)) addWithId:id__];
  [((JavaLangStringBuilder *) NIL_CHK(sb)) appendWithNSString:@"DefaultIndexReference ["];
  [[((JavaLangStringBuilder *) NIL_CHK(sb)) appendWithNSString:@"id="] appendWithNSString:[self getId]];
  [[((JavaLangStringBuilder *) NIL_CHK(sb)) appendWithNSString:@", objectId="] appendWithNSString:referencedObject__];
  [[((JavaLangStringBuilder *) NIL_CHK(sb)) appendWithNSString:@", index="] appendWithInt:[self index]];
  [[((JavaLangStringBuilder *) NIL_CHK(sb)) appendWithNSString:@", canBeDeleted="] appendWithBOOL:canBeDeleted__];
  [((JavaLangStringBuilder *) NIL_CHK(sb)) appendWithNSString:@"]"];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  GDRIndexReference *typedCopy = (GDRIndexReference *) copy;
  typedCopy.referencedObject_ = referencedObject__;
  typedCopy.index_ = index__;
  typedCopy.canBeDeleted_ = canBeDeleted__;
}

@end
