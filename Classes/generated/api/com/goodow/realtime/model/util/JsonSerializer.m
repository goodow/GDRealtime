//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//
//  Created by Larry Tin <dev@goodow.com>
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "com/goodow/realtime/CollaborativeObject.h"
#include "com/goodow/realtime/model/util/JsonSerializer.h"
#include "com/goodow/realtime/operation/util/JsonUtility.h"
#include "elemental/json/Json.h"
#include "elemental/json/JsonArray.h"
#include "elemental/json/JsonBoolean.h"
#include "elemental/json/JsonFactory.h"
#include "elemental/json/JsonNumber.h"
#include "elemental/json/JsonString.h"
#include "elemental/json/JsonType.h"
#include "elemental/json/JsonValue.h"
#include "java/lang/Boolean.h"
#include "java/lang/ClassCastException.h"
#include "java/lang/Double.h"
#include "java/lang/RuntimeException.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/Map.h"

@implementation ComGoodowRealtimeModelUtilJsonSerializer

+ (int)REFERENCE_TYPE {
  return ComGoodowRealtimeModelUtilJsonSerializer_REFERENCE_TYPE;
}

+ (id)deserializeObjectWithGDRJsonValue:(id<GDRJsonValue>)arrayOrNull
                        withJavaUtilMap:(id<JavaUtilMap>)objects {
  if ([ComGoodowRealtimeOperationUtilJsonUtility isNullWithGDRJsonValue:arrayOrNull]) {
    return nil;
  }
  id<GDRJsonArray> array = (id<GDRJsonArray>) check_protocol_cast(arrayOrNull, @protocol(GDRJsonArray));
  switch ((int) [((id<GDRJsonArray>) nil_chk(array)) getNumberWithInt:0]) {
    case ComGoodowRealtimeModelUtilJsonSerializer_VALUE_TYPE:
    {
      id<GDRJsonValue> val;
      switch ([[((id<GDRJsonValue>) nil_chk([array getWithInt:1])) getType] ordinal]) {
        case GDRJsonType_BOOLEAN:
        return [JavaLangBoolean valueOfWithBoolean:[array getBooleanWithInt:1]];
        case GDRJsonType_NUMBER:
        return [JavaLangDouble valueOfWithDouble:[array getNumberWithInt:1]];
        case GDRJsonType_STRING:
        return [array getStringWithInt:1];
        case GDRJsonType_OBJECT:
        case GDRJsonType_ARRAY:
        val = [array getWithInt:1];
        return [((id<GDRJsonFactory>) nil_chk([GDRJson instance])) parseWithNSString:[((id<GDRJsonValue>) nil_chk(val)) toJson]];
        case GDRJsonType_NULL:
        default:
        @throw [[JavaLangRuntimeException alloc] initWithNSString:@"Should not reach here!"];
      }
    }
    case ComGoodowRealtimeModelUtilJsonSerializer_REFERENCE_TYPE:
    return [((id<JavaUtilMap>) nil_chk(objects)) getWithId:[array getStringWithInt:1]];
    default:
    @throw [[JavaLangUnsupportedOperationException alloc] init];
  }
}

+ (id<GDRJsonArray>)serializeObjectWithId:(id)obj {
  if (obj == nil) {
    return nil;
  }
  id<GDRJsonArray> array = [GDRJson createArray];
  int type = ComGoodowRealtimeModelUtilJsonSerializer_VALUE_TYPE;
  id<GDRJsonValue> val;
  if ([obj isKindOfClass:[NSString class]]) {
    val = [GDRJson createWithNSString:(NSString *) check_class_cast(obj, [NSString class])];
  }
  else if ([obj isKindOfClass:[NSNumber class]]) {
    val = [GDRJson createWithDouble:[((NSNumber *) nil_chk(obj)) doubleValue]];
  }
  else if ([obj isKindOfClass:[JavaLangBoolean class]]) {
    val = [GDRJson createWithBoolean:[((JavaLangBoolean *) nil_chk(obj)) booleanValue]];
  }
  else if ([obj conformsToProtocol: @protocol(GDRJsonValue)]) {
    val = (id<GDRJsonValue>) check_protocol_cast(obj, @protocol(GDRJsonValue));
    if ([GDRJsonTypeEnum NULL_] == [((id<GDRJsonValue>) nil_chk(val)) getType]) {
      return nil;
    }
    val = [((id<GDRJsonFactory>) nil_chk([GDRJson instance])) parseWithNSString:[val toJson]];
  }
  else if ([obj isKindOfClass:[GDRCollaborativeObject class]]) {
    type = ComGoodowRealtimeModelUtilJsonSerializer_REFERENCE_TYPE;
    val = [GDRJson createWithNSString:[((GDRCollaborativeObject *) nil_chk(obj)) getId]];
  }
  else {
    @throw [[JavaLangClassCastException alloc] initWithNSString:[NSString stringWithFormat:@"Unsupported class type: %@", [[nil_chk(obj) getClass] getName]]];
  }
  [((id<GDRJsonArray>) nil_chk(array)) setWithInt:0 withDouble:type];
  [array setWithInt:1 withGDRJsonValue:val];
  return array;
}

+ (IOSObjectArray *)serializeObjectsWithNSObjectArray:(IOSObjectArray *)values {
  IOSObjectArray *array = [IOSObjectArray arrayWithLength:(int) [((IOSObjectArray *) nil_chk(values)) count] type:[IOSClass classWithProtocol:@protocol(GDRJsonValue)]];
  int i = 0;
  {
    IOSObjectArray *a__ = values;
    id const *b__ = a__->buffer_;
    id const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      id obj = (*b__++);
      (void) IOSObjectArray_Set(array, i++, [ComGoodowRealtimeModelUtilJsonSerializer serializeObjectWithId:obj]);
    }
  }
  return array;
}

- (id)init {
  return [super init];
}

@end
